{% extends 'shared/layout.html' %}

{% block extracss %}
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/chat.css') }}">
{% endblock %}

{% block extrajs %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js" integrity="sha512-q/dWJ3kcmjBLU4Qc47E4A9kTB4m3wuTY7vkFJDTZKjTs8jhyGQnaUrxa0Ytd0ssMZhbNua9hE+E7Qv1j+DyZwA==" crossorigin="anonymous"></script>
<script src="{{ url_for('static', filename='js/chat.js') }}"></script>
{% endblock %}

{% block maincontent %}
<div class="container" style="margin-top: 60px;" id="centralDivLanding">
  <div class="heading1"><br><br><br><br>
    <h2><center>ğŸ¬ PopcornPicksğŸ¿: Chat with others about Movies! ğŸ¬</center></h2>
  </div>
    <div class="card d-flex flex-column">
    <div class="card-header text-secondary">
        Live Movie Chat
    </div>
    <ul id="message_list" class="list-group flex-grow-1 overflow-auto"></ul>
    <form id="form" class="form-inline" action="" onsubmit="submiter(); return false;">
        <div class="form-group">
            <input id="input" class="form-control mr-2" autocomplete="off" />
            <!-- å¯†ç è¾“å…¥æ¡† -->
            <input type="password" id="password" placeholder="Enter your chat password..." />
        </div>
        <button type="submit" class="btn btn-primary ms-2">Send</button>
    </form>
</div>

</div>
<script>
    // æ¨¡æ‹Ÿçš„å¯†ç ï¼Œå®é™…é¡¹ç›®ä¸­ä½ å¯ä»¥ä»æœåŠ¡å™¨ç«¯è·å–æˆ–é€šè¿‡æ›´å®‰å…¨çš„æ–¹å¼ç®¡ç†
    var chatPassword = "secretPassword";
    
    function submitMessage() {
        // è·å–è¾“å…¥çš„æ¶ˆæ¯å’Œå¯†ç 
        var msg = document.getElementById('input');
        var password = document.getElementById('password');
        
        // æ£€æŸ¥å¯†ç æ˜¯å¦æ­£ç¡®
        if (password.value === chatPassword) {
            // å¦‚æœå¯†ç æ­£ç¡®ï¼Œå‘é€æ¶ˆæ¯
            console.log("Message sent:", msg.value);
            socket.emit('message', { username: '{{user}}', msg: msg.value });
            
            // æ¸…ç©ºè¾“å…¥æ¡†å’Œå¯†ç æ¡†
            msg.value = '';
            password.value = '';
        } else {
            // å¦‚æœå¯†ç ä¸æ­£ç¡®ï¼Œç»™å‡ºæç¤º
            alert("Incorrect password. Please try again.");
        }
        
        return false; // ç¡®ä¿é¡µé¢ä¸åˆ·æ–°
    }
    </script>


{% endblock %}